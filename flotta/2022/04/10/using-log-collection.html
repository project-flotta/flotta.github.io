<!DOCTYPE html>
<html lang="en">

<head>
  <script id="dpal" src="//www.redhat.com/ma/dpal.js" type="text/javascript"></script>
  <meta charset="utf-8">
  <title>Log Collection on Flotta devices</title>

  <!-- mobile responsive meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="this is meta description">

  

  <!-- ** Plugins Needed for the Project ** -->
  
  <link rel="stylesheet" href="/assets/plugins/bootstrap/bootstrap.min.css">
  
  <link rel="stylesheet" href="/assets/plugins/themify-icons/themify-icons.css">
  
  <link rel="stylesheet" href="/assets/plugins/slick/slick.css">
  

  <link href="/assets/scss/syntax_monokai.css" rel="stylesheet">
  <!-- Main Stylesheet -->
  <link href="/assets/scss/style.css" rel="stylesheet">

  <!--Favicon-->
  <link rel="shortcut icon" href="/assets/images/favicon.png " type="image/x-icon">
  <link rel="icon" href="/assets/images/flotta-logo-stacked.ico " type="image/x-icon">

  <!-- google analytics -->
  

</head>


<body>

  <header class="navigation fixed-top nav-bg">
  <nav class="navbar navbar-expand-lg navbar-dark">
    <a class="navbar-brand font-tertiary h3" href="/">
      
        <img src="/assets/images/flotta-logo.png" alt="Project Flotta" style="height: 60px;">
        
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navigation"
      aria-controls="navigation" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse text-center" id="navigation">
      <ul class="navbar-nav ml-auto">
        <li class="nav-item active">
          <a class="nav-link" href="/">Home</a>
        </li>
        
          <li class="nav-item ">
            <a class="nav-link" href="/blog.html">Blog</a>
          </li>
        
          <li class="nav-item ">
            <a class="nav-link" href="/documentation/v0_2_0/intro/overview.html">Documentation</a>
          </li>
        
      </ul>
    </div>
  </nav>
</header>


  <section class="section skip_top">
  <div class="container documentation">
    <div class="row">
      <div class="col-lg-12">
        <h1 class="font-tertiary mb-5">Log Collection on Flotta devices</h1>
        <p class="font-secondary">Published on Apr 10, 2022 by <span class="text-primary">Eloy Coto <eloycoto@acalustra.com></span
            class="text-primary"> on <span>guide </span><span>flotta </span><span>logs </span></p>
        <div class="content">
          

          <p>When running thousands of devices on the far edge, log collection retrieval may
differ from one site to another, as also the limit of data that can be sent
from the device or stored in the device.</p>

<p>At the same time, workload logs can vary in terms of importance, so the backup
workload logs maybe need to be always pushed, and maybe another workload with
less importance can lose logs on network connectivity issues. At the same time,
maybe you don’t want workload that manages any personal information to send
information outside the country.</p>

<p>For that, Flotta introduces log collection targets, so each device - or
deviceSets- will have a set of custom logs servers that one workload can use to
send the logs to.</p>

<p><img src="/assets/images/DeviceLogsConfig.png" alt="Device Logs diagram" /></p>

<p>The main use case is to be able to define servers in edge devices and these
servers to be consumed by the workloads; this way user roles are very well
defined - edge-administrators define the servers and developers use the given
values.</p>

<p><em>A sample workflow for a retail store can be:</em></p>

<p><strong>Edge Device Administrator:</strong> defines the device security, heartbeat and
general options based on the device or deviceSet. In this case, will define two
kinds of logs servers, LogSecure which always pushes the logs to the server,
with big storing buffers. At the same time, there is a logGeneral, that is the
server that may lose logs on network downtime, or maybe using different
transports.</p>

<p><strong>Edge developer:</strong> In this case, the developer knows that for running the
workload in all stores, there are always two kinds of log servers that can be
used, because Edge Administration shared all the details about buffer, quotas
and destination.</p>

<p>To collect logs, a subprocess reads the workloads stdout and pushes it to a
buffer, even if the device is disconnected from network for a while, it’ll push
the right timestamp to the server, due to the buffer being aware of the log was
retrieved. When the buffer is full, some logs will be dropped to avoid filling
the RAM on the device.</p>

<p>Regarding transports, at the moment, the Flotta device agent only supports raw
Syslog transport, but in the following releases, new transports will be added,
like Loki, Kafka, Elastic and MQTT.</p>

<h2 id="example-setup">Example setup</h2>

<p>It’s quite easy to setup an edge device; in case of Syslog, the following
config-maps should be in place:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>---
apiVersion: v1
kind: ConfigMap
metadata:
  name: dc1-syslog
  namespace: default
data:
  Address: dc1.syslog.project-flotta.io:601
  Protocol: tcp
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: secure-syslog
  namespace: default
data:
  Address: secure.dc1.syslog.project-flotta.io:601
  Protocol: tcp
</code></pre></div></div>

<p>Per each device, the following <code class="language-plaintext highlighter-rouge">logCollection</code> attribute should be added:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>—--
apiVersion: management.project-flotta.io/v1alpha1
kind: EdgeDevice
metadata:
  name: e5f44cc8ddfb408a9b85f54c0c3efa02
  namespace: default
spec:
  requestTime: "2022-03-23T11:40:59Z"
  logCollection:
   dc1-syslog:
     bufferSize: 10
     kind: syslog
     syslogConfig:
       name: dc1-syslog
   secure-syslog:
     bufferSize: 100
     kind: syslog
     syslogConfig:
       name: secure-syslog
</code></pre></div></div>

<p>So, dc1-syslog will only store 10Mb of logs in the buffer, meanwhile dc1-syslog
can submit much bigger logs and make sure that logs are not dropped.</p>

<h2 id="edge-workload-setup">Edge Workload setup</h2>

<p>At the EdgeWorkload, the following information should be added:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>apiVersion: management.project-flotta.io/v1alpha1
kind: EdgeWorkload
metadata:
  name: random-workload
spec:
  logCollection: dc1-syslog
  deviceSelector:
    matchLabels:
      app: foo
  type: pod
  pod:
    spec:
      containers:
        - name: random-server
          image: docker.io/eloycoto/logexample
</code></pre></div></div>

<p>And for secure syslog server can be the following:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>apiVersion: management.project-flotta.io/v1alpha1
kind: EdgeWorkload
metadata:
  name: payment-workload
spec:
  logCollection: secure-syslog
  deviceSelector:
    matchLabels:
      app: foo
  type: pod
  pod:
    spec:
      containers:
        - name: random-server
          image: docker.io/eloycoto/payments:v1
</code></pre></div></div>

<p>So each deployment will use the log collection given by the edge-administrator.</p>

        </div>
      </div>
    </div>
  </div>
</section>



<!-- blog -->
<section class="section">
  <div class="container">
    <div class="row">
      <div class="col-12 text-center">
        <h2 class="section-title">Similar Stories</h2>
      </div>
      
      <div class="col-lg-4 col-sm-6 mb-4">
  <article class="card shadow">
    
    <div class="card-body">
      <h4 class="card-title">
        <a class="text-dark" href="/flotta/2022/09/28/run-ansible-playbooks.html">Running Ansible Playbooks on Edge Devices</a>
      </h4>
      <p class="card-text">There may be cases in which you would like to be able to execute a scripts or commands in a device or on a group of devices. For example, in...</p>
      <a href="/flotta/2022/09/28/run-ansible-playbooks.html" class="btn btn-xs btn-primary">Read More</a>
    </div>
  </article>
</div>

      
      <div class="col-lg-4 col-sm-6 mb-4">
  <article class="card shadow">
    
    <div class="card-body">
      <h4 class="card-title">
        <a class="text-dark" href="/flotta/2022/09/05/edge-example-app-sense-the-internet-part-2.html">Edge Example App: Sense the Internet Part 2</a>
      </h4>
      <p class="card-text">Edge Example App is an app for Flotta Edge devices, with a workload that will be deployed on the device that has two main features: Sensing the Internet (which helps...</p>
      <a href="/flotta/2022/09/05/edge-example-app-sense-the-internet-part-2.html" class="btn btn-xs btn-primary">Read More</a>
    </div>
  </article>
</div>

      
      <div class="col-lg-4 col-sm-6 mb-4">
  <article class="card shadow">
    
    <div class="card-body">
      <h4 class="card-title">
        <a class="text-dark" href="/flotta/2022/09/05/edge-example-app-cpu-temp.html">Edge Example App: CPU Temperature</a>
      </h4>
      <p class="card-text">Edge Example App is an app for Flotta Edge devices, with a workload that will be deployed on the device that has two main features:
</p>
      <a href="/flotta/2022/09/05/edge-example-app-cpu-temp.html" class="btn btn-xs btn-primary">Read More</a>
    </div>
  </article>
</div>

      
    </div>
  </div>
</section>
<!-- /blog -->


  <!-- footer -->
<footer class="bg-dark footer-section">
  <div class="section">
    <div class="container">
      <div class="row">
        <div class="col-md-4">
          <h5 class="text-light">Email</h5>
          <p class="text-white paragraph-lg font-secondary">flotta@redhat.com</p>
        </div>
        <div class="col-md-4">
          <h5><a href="http://www.redhat.com"><img id="sponsorship" class="footerLogo" src="/assets/images/Logo-Red_Hat-Supported_By-A-Reverse-RGB.svg"></a>.</h5>
        </div>
        <!-- <div class="col-md-4"> -->
        <!--   <h5 class="text-light">Address</h5> -->
        <!--   <p class="text-white paragraph-lg font-secondary"></p> -->
        <!-- </div> -->
      </div>
    </div>
  </div>
  <div class="border-top text-center border-dark py-5">
    <p class="mb-0 text-light"><p>Copyright © 2020 Designed by <a href="https://themefisher.com">Themefisher</a> &amp; Developed by <a href="https://getjekyllthemes.com">Getjekyllthemes</a></p>
</p>
  </div>
</footer>
<!-- /footer -->


<!-- JS Plugins -->

<script src="/assets/plugins/jQuery/jquery.min.js"></script>

<script src="/assets/plugins/bootstrap/bootstrap.min.js"></script>

<script src="/assets/plugins/shuffle/shuffle.min.js"></script>

<script src="/assets/plugins/slick/slick.min.js"></script>


<!-- Main Script -->
<script src="/assets/js/script.js"></script>

<!-- This comes from DTM/DPAL and must be latest entry in body-->
<script type="text/javascript">
  if (("undefined" !== typeof _satellite) && ("function" === typeof _satellite.pageBottom)) {
      _satellite.pageBottom();
  }
</script>


<script>
  $(function() {
    return $("h2, h3, h4, h5, h6").each(function(i, el) {
      var $el, icon, id;
      $el = $(el);
      id = $el.attr('id');
      icon = '<i class="ti-link"></i>';
      console.log("test test"+id)
      if (id) {
        return $el.prepend($("<a />").addClass("header-link").attr("href", "#" + id).html(icon));
      }
    });
  });
</script>


</body>

</html>
