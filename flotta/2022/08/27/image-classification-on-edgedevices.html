<!DOCTYPE html>
<html lang="en">

<head>
  <script id="dpal" src="//www.redhat.com/ma/dpal.js" type="text/javascript"></script>
  <meta charset="utf-8">
  <title>Flotta Image Classification tool for edgedevices</title>

  <!-- mobile responsive meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="this is meta description">

  

  <!-- ** Plugins Needed for the Project ** -->
  
  <link rel="stylesheet" href="/assets/plugins/bootstrap/bootstrap.min.css">
  
  <link rel="stylesheet" href="/assets/plugins/themify-icons/themify-icons.css">
  
  <link rel="stylesheet" href="/assets/plugins/slick/slick.css">
  

  <link href="/assets/scss/syntax_monokai.css" rel="stylesheet">
  <!-- Main Stylesheet -->
  <link href="/assets/scss/style.css" rel="stylesheet">

  <!--Favicon-->
  <link rel="shortcut icon" href="/assets/images/favicon.png " type="image/x-icon">
  <link rel="icon" href="/assets/images/flotta-logo-stacked.ico " type="image/x-icon">

  <!-- google analytics -->
  

</head>


<body>

  <header class="navigation fixed-top nav-bg">
  <nav class="navbar navbar-expand-lg navbar-dark">
    <a class="navbar-brand font-tertiary h3" href="/">
      
        <img src="/assets/images/flotta-logo.png" alt="Project Flotta" style="height: 60px;">
        
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navigation"
      aria-controls="navigation" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse text-center" id="navigation">
      <ul class="navbar-nav ml-auto">
        <li class="nav-item active">
          <a class="nav-link" href="/">Home</a>
        </li>
        
          <li class="nav-item ">
            <a class="nav-link" href="/blog.html">Blog</a>
          </li>
        
          <li class="nav-item ">
            <a class="nav-link" href="/documentation/v0_2_0/intro/overview.html">Documentation</a>
          </li>
        
      </ul>
    </div>
  </nav>
</header>


  <section class="section skip_top">
  <div class="container documentation">
    <div class="row">
      <div class="col-lg-12">
        <h1 class="font-tertiary mb-5">Flotta Image Classification tool for edgedevices</h1>
        <p class="font-secondary">Published on Aug 27, 2022 by <span class="text-primary">Deependra Singh Shekhawat</span
            class="text-primary"> on <span>guide </span><span>flotta </span><span>image-classification </span></p>
        <div class="content">
          

          <p>The ability to detect objects is essential in a number of fields, including computer vision, robotics, and autonomous driving. With the idea of applying real-time object identification on edge devices with low inference time and high accuracy, many approaches to object detection can hardly operate on the resource-constrained edge devices.</p>

<p>The Flotta Image Classification tool overcomes the aforementioned limitations, by delivering amazingly precise object detection while enabling faster object detection on edge devices (like Raspberry Pi, etc.)</p>

<p>Workload Dependencies -</p>
<ul>
  <li>Python &gt;=3.7</li>
  <li>OpenCV 4.6</li>
</ul>

<p>Device configuration (at least) -</p>
<ul>
  <li>CPU 1GHz</li>
  <li>Memory 1024MB</li>
  <li>Disk Space 2GB</li>
</ul>

<h2 id="prerequisite">Prerequisite</h2>
<ul>
  <li>Flotta-configured device. (see <a href="https://project-flotta.io/documentation/v0_2_0/intro/overview.html">documentation</a>)</li>
</ul>

<h2 id="getting-started">Getting Started</h2>

<p><strong>Project repository can be found <a href="https://github.com/project-flotta/image-classification">here</a>.</strong></p>

<h3 id="preparations">Preparations</h3>
<p>As part of the flotta installation, prioritizing security of containers we create the user flotta and utilise that user to execute the tasks.
By default, the flotta user does not have access to any mounted devices, thus we must first make changes to provide flotta user access to the device in <code class="language-plaintext highlighter-rouge">/dev</code> before configuring the runtime to permit the access.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#video group access to flotta user </span>
<span class="o">[</span>root@device ~]# usermod <span class="nt">-a</span> <span class="nt">-G</span> video flotta

<span class="c">#expected</span>
<span class="o">[</span>root@device ~]# <span class="nb">id </span>flotta
<span class="nv">uid</span><span class="o">=</span>1001<span class="o">(</span>flotta<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1001<span class="o">(</span>flotta<span class="o">)</span> <span class="nb">groups</span><span class="o">=</span>1001<span class="o">(</span>flotta<span class="o">)</span>,39<span class="o">(</span>video<span class="o">)</span>
</code></pre></div></div>

<p>Following device <a href="https://project-flotta.io/flotta/2022/04/15/flotta-and-raspberry-pi.html#installation">registration</a>, to run our workload on specific device, we need to label the device -</p>

<p>Use following command to add the label:</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl label edgedevice &lt;device CR name&gt; <span class="nv">app</span><span class="o">=</span>camera
</code></pre></div></div>

<p>Confirm that you have an EdgeDevice labelled with app=camera</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl get edgedevice <span class="nt">-l</span> <span class="nv">app</span><span class="o">=</span>camera
NAME                                          AGE
ff8612a5bd1a40cca403ac1fc95cc2ad              3m
</code></pre></div></div>
<p>Now we will define the manifests using the same label.</p>

<p><strong>Next</strong>, you will need a webcam mounted to your workload or else it fails with no device connected. Change the device id from 0 to 1/2/3… specific to your device.</p>

<p>Using the webcam in my system as an example mounted in /dev/video0. Make sure you specify them in the <code class="language-plaintext highlighter-rouge">edgeworkload.yaml</code> -</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">volumemounts</span><span class="pi">:</span>
 <span class="pi">-</span> <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/dev/video0</span>
   <span class="na">name</span><span class="pi">:</span> <span class="s">video</span>
</code></pre></div></div>
<p>(and here)</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">volumes</span><span class="pi">:</span>
<span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">video</span> 
  <span class="na">hostPath</span><span class="pi">:</span>
    <span class="na">path</span><span class="pi">:</span> <span class="s">/dev/video0</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">File</span>
</code></pre></div></div>

<h3 id="storage">Storage</h3>
<p>Specified in <code class="language-plaintext highlighter-rouge">edgedevice.yaml</code>.</p>

<p><strong>Keep in mind</strong> the S3 api credentials should be <code class="language-plaintext highlighter-rouge">base64</code> encoded in <code class="language-plaintext highlighter-rouge">secrets.yaml</code>, else the data sync will not initiate.</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">storage</span><span class="pi">:</span>
    <span class="na">s3</span><span class="pi">:</span>
      <span class="na">secretName</span><span class="pi">:</span> <span class="s">s3secret</span> <span class="c1"># secret containing S3 API access credentials</span>
      <span class="na">configMapName</span><span class="pi">:</span> <span class="s">s3config</span> <span class="c1"># configmap containing S3 API access configuration options</span>
</code></pre></div></div>
<p>The default directory <code class="language-plaintext highlighter-rouge">"../export/images/"</code> is used for saving images.</p>

<p>Note: Any path that you specify in data sync configuration should be placed under /export in the container.</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">data</span><span class="pi">:</span>
    <span class="na">egress</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">source</span><span class="pi">:</span> <span class="s">images</span> <span class="c1"># container folder under /export</span>
        <span class="na">target</span><span class="pi">:</span> <span class="s">images</span> <span class="c1"># object storage bucket folder</span>
</code></pre></div></div>
<p>Note: Data is synced every 15 seconds.</p>

<h3 id="deploy">Deploy</h3>
<p>First deploying the <code class="language-plaintext highlighter-rouge">configmaps.yaml</code> and <code class="language-plaintext highlighter-rouge">secrets.yaml</code> manifests following <code class="language-plaintext highlighter-rouge">edgedevice.yaml</code> then finally <code class="language-plaintext highlighter-rouge">edgeworkload.yaml</code>.</p>

<p>Let’s monitor EdgeDevice object in our cluster to see when the device becomes available:</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>watch <span class="nt">-t</span> kubectl get edgedevice ff8612a5bd1a40cca403ac1fc95cc2ad <span class="nt">-ojsonpath</span><span class="o">=</span><span class="s2">"{.status.workloads}"</span>
</code></pre></div></div>
<p>it should show our workload -</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[{"lastTransitionTime":"2022-08-28T16:03:51Z","name":"edge-ic-workload","phase":"Running"}]
</code></pre></div></div>
<p>(if showing <code class="language-plaintext highlighter-rouge">deploying</code> phase, wait for a while as the image is being pulled)</p>

<h3 id="controls-startstop">Controls (START/STOP)</h3>
<ol>
  <li>Using environment variable in <code class="language-plaintext highlighter-rouge">configmaps.yaml</code> -
    <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">data</span><span class="pi">:</span>
  <span class="na">CAPTURE</span><span class="pi">:</span> <span class="s2">"</span><span class="s">True"</span> <span class="c1"># starts detection </span>
</code></pre></div>    </div>
    <p>Setting <code class="language-plaintext highlighter-rouge">CAPTURE: "False"</code> will stop the camera but keep the workload running.</p>
    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl apply <span class="nt">-f</span> configmaps.yaml
</code></pre></div>    </div>
  </li>
  <li>(OR) Removing the workload from the device using -
    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl delete <span class="nt">-f</span> edgeworkload.yaml
</code></pre></div>    </div>
  </li>
</ol>

<h3 id="output--">Output -</h3>

<p>SSH to the device and become the flotta user to access the container and see that the images were created -</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@fedora]<span class="nv">$ </span><span class="nb">sudo </span>su <span class="nt">-l</span> flotta <span class="nt">-s</span> /bin/bash <span class="nt">-c</span> <span class="s2">"podman exec -it edge-ic-workload-edge-ic-workload ls ../export/images/"</span>
2022-08-29_17-32-58.jpeg      2022-08-29_17-33-03.jpeg
2022-08-29_17-32-58.json      2022-08-29_17-33-03.json
</code></pre></div></div>
<p>Using json for keeping track of detected objects specific to images -</p>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="nl">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2022-08-29_17-32-58"</span><span class="p">,</span><span class="w"> </span><span class="nl">"detected"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"tvmonitor"</span><span class="p">,</span><span class="w"> </span><span class="s2">"laptop"</span><span class="p">,</span><span class="w"> </span><span class="s2">"keyboard"</span><span class="p">]}</span><span class="w">
</span></code></pre></div></div>
<blockquote>
  <p>Note: Remember that the files are only produced when an object is found, thus if none are produced, this might be the case.</p>
</blockquote>

<h3 id="configurable-parameters">Configurable parameters</h3>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">data</span><span class="pi">:</span>
  <span class="na">CAPTURE</span><span class="pi">:</span> <span class="s2">"</span><span class="s">True"</span>
  <span class="na">THRES</span><span class="pi">:</span> <span class="s2">"</span><span class="s">0.25"</span>
  <span class="na">TIMEINT</span><span class="pi">:</span> <span class="s2">"</span><span class="s">5"</span>
</code></pre></div></div>
<p><img src="/assets/images/flotta_image_classification-table.png" alt="Table" /></p>

<h2 id="workflow">Workflow</h2>
<p><img src="/assets/images/flotta_image_classification-workflow.png" alt="Workflow" /></p>

<p>Once the edge device is configured, it begins real-time object recognition on the camera feed at the specified time interval and if an object is detected it captures and stores the images with the localization of those objects.</p>

<p>The functionality of the Flotta agent and Operator of bidirectional data sync between the device and storage is then used to sync these images from the device with object storage. (Learn more on Data Synchronization <a href="https://project-flotta.io/documentation/v0_2_0/operations/data_synchronization.html">here</a>)</p>

<p>Next the images can be browsed using flotta web app running in a cluster.</p>

<p>(<em>Quick tip</em>: Click on the images for expanded view)</p>

<p>Some example images detected using Flotta Image Classification Tool <a href="http://www.youtube.com/watch?v=RHNfVsw2V7E">here</a>.</p>

<p>Please feel free to share any issues or propose new ideas at <a href="https://github.com/project-flotta/image-classification/issues">GitHub Issues</a></p>

        </div>
      </div>
    </div>
  </div>
</section>



<!-- blog -->
<section class="section">
  <div class="container">
    <div class="row">
      <div class="col-12 text-center">
        <h2 class="section-title">Similar Stories</h2>
      </div>
      
      <div class="col-lg-4 col-sm-6 mb-4">
  <article class="card shadow">
    
    <div class="card-body">
      <h4 class="card-title">
        <a class="text-dark" href="/flotta/2022/09/28/run-ansible-playbooks.html">Running Ansible Playbooks on Edge Devices</a>
      </h4>
      <p class="card-text">There may be cases in which you would like to be able to execute a scripts or commands in a device or on a group of devices. For example, in...</p>
      <a href="/flotta/2022/09/28/run-ansible-playbooks.html" class="btn btn-xs btn-primary">Read More</a>
    </div>
  </article>
</div>

      
      <div class="col-lg-4 col-sm-6 mb-4">
  <article class="card shadow">
    
    <div class="card-body">
      <h4 class="card-title">
        <a class="text-dark" href="/flotta/2022/09/05/edge-example-app-sense-the-internet-part-2.html">Edge Example App: Sense the Internet Part 2</a>
      </h4>
      <p class="card-text">Edge Example App is an app for Flotta Edge devices, with a workload that will be deployed on the device that has two main features: Sensing the Internet (which helps...</p>
      <a href="/flotta/2022/09/05/edge-example-app-sense-the-internet-part-2.html" class="btn btn-xs btn-primary">Read More</a>
    </div>
  </article>
</div>

      
      <div class="col-lg-4 col-sm-6 mb-4">
  <article class="card shadow">
    
    <div class="card-body">
      <h4 class="card-title">
        <a class="text-dark" href="/flotta/2022/09/05/edge-example-app-cpu-temp.html">Edge Example App: CPU Temperature</a>
      </h4>
      <p class="card-text">Edge Example App is an app for Flotta Edge devices, with a workload that will be deployed on the device that has two main features:
</p>
      <a href="/flotta/2022/09/05/edge-example-app-cpu-temp.html" class="btn btn-xs btn-primary">Read More</a>
    </div>
  </article>
</div>

      
    </div>
  </div>
</section>
<!-- /blog -->


  <!-- footer -->
<footer class="bg-dark footer-section">
  <div class="section">
    <div class="container">
      <div class="row">
        <div class="col-md-4">
          <h5 class="text-light">Email</h5>
          <p class="text-white paragraph-lg font-secondary">flotta@redhat.com</p>
        </div>
        <div class="col-md-4">
          <h5><a href="http://www.redhat.com"><img id="sponsorship" class="footerLogo" src="/assets/images/Logo-Red_Hat-Supported_By-A-Reverse-RGB.svg"></a>.</h5>
        </div>
        <!-- <div class="col-md-4"> -->
        <!--   <h5 class="text-light">Address</h5> -->
        <!--   <p class="text-white paragraph-lg font-secondary"></p> -->
        <!-- </div> -->
      </div>
    </div>
  </div>
  <div class="border-top text-center border-dark py-5">
    <p class="mb-0 text-light"><p>Copyright © 2020 Designed by <a href="https://themefisher.com">Themefisher</a> &amp; Developed by <a href="https://getjekyllthemes.com">Getjekyllthemes</a></p>
</p>
  </div>
</footer>
<!-- /footer -->


<!-- JS Plugins -->

<script src="/assets/plugins/jQuery/jquery.min.js"></script>

<script src="/assets/plugins/bootstrap/bootstrap.min.js"></script>

<script src="/assets/plugins/shuffle/shuffle.min.js"></script>

<script src="/assets/plugins/slick/slick.min.js"></script>


<!-- Main Script -->
<script src="/assets/js/script.js"></script>

<!-- This comes from DTM/DPAL and must be latest entry in body-->
<script type="text/javascript">
  if (("undefined" !== typeof _satellite) && ("function" === typeof _satellite.pageBottom)) {
      _satellite.pageBottom();
  }
</script>


<script>
  $(function() {
    return $("h2, h3, h4, h5, h6").each(function(i, el) {
      var $el, icon, id;
      $el = $(el);
      id = $el.attr('id');
      icon = '<i class="ti-link"></i>';
      console.log("test test"+id)
      if (id) {
        return $el.prepend($("<a />").addClass("header-link").attr("href", "#" + id).html(icon));
      }
    });
  });
</script>


</body>

</html>
