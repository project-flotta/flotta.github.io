<!DOCTYPE html>
<html lang="en">

<head>
  <script id="dpal" src="//www.redhat.com/ma/dpal.js" type="text/javascript"></script>
  <meta charset="utf-8">
  <title>Getting started with Flotta Operator Part 1</title>

  <!-- mobile responsive meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="this is meta description">

  

  <!-- ** Plugins Needed for the Project ** -->
  
  <link rel="stylesheet" href="/assets/plugins/bootstrap/bootstrap.min.css">
  
  <link rel="stylesheet" href="/assets/plugins/themify-icons/themify-icons.css">
  
  <link rel="stylesheet" href="/assets/plugins/slick/slick.css">
  

  <link href="/assets/scss/syntax_monokai.css" rel="stylesheet">
  <!-- Main Stylesheet -->
  <link href="/assets/scss/style.css" rel="stylesheet">

  <!--Favicon-->
  <link rel="shortcut icon" href="/assets/images/favicon.png " type="image/x-icon">
  <link rel="icon" href="/assets/images/flotta-logo-stacked.ico " type="image/x-icon">

  <!-- google analytics -->
  

</head>


<body>

  <header class="navigation fixed-top nav-bg">
  <nav class="navbar navbar-expand-lg navbar-dark">
    <a class="navbar-brand font-tertiary h3" href="/">
      
        <img src="/assets/images/flotta-logo.png" alt="Project Flotta" style="height: 60px;">
        
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navigation"
      aria-controls="navigation" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse text-center" id="navigation">
      <ul class="navbar-nav ml-auto">
        <li class="nav-item active">
          <a class="nav-link" href="/">Home</a>
        </li>
        
          <li class="nav-item ">
            <a class="nav-link" href="/blog.html">Blog</a>
          </li>
        
          <li class="nav-item ">
            <a class="nav-link" href="/documentation/v0_2_0/intro/overview.html">Documentation</a>
          </li>
        
      </ul>
    </div>
  </nav>
</header>


  <section class="section skip_top">
  <div class="container documentation">
    <div class="row">
      <div class="col-lg-12">
        <h1 class="font-tertiary mb-5">Getting started with Flotta Operator Part 1</h1>
        <p class="font-secondary">Published on Feb 03, 2022 by <span class="text-primary">Ondra Machacek</span
            class="text-primary"> on <span>guide </span><span>flotta </span></p>
        <div class="content">
          

          <p>In this blog post series we would like to show you how to get started with the <em>Flotta</em> project.
The <em>Flotta</em> operator is the Kubernetes operator used to manage the workloads of the edge devices via
Kubernetes API. In order to manage the edgedevices and workloads you need to have Kubernetes or OpenShift up and
running. Unfortunately the <em>Flotta</em> operator is not yet published on the operator hub, so we have to deploy it manually from the github repo.</p>

<h3 id="install-prerequisites-for-flotta-operator">Install Prerequisites for Flotta Operator</h3>
<p>Following are the prerequisites:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> - Kubernetes or OpenShift cluster running with kubectl configured
 - Cert manager
 - OpenShift route
 - Noobaa <span class="o">(</span>optional<span class="o">)</span>
</code></pre></div></div>

<p><em>Flotta</em> requires the <a href="https://cert-manager.io/docs/">cert manager</a> for TLS key management for webhooks, so if you don’t have it up and running on your cluster,
you can execute following command to install it:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl apply <span class="nt">-f</span> https://github.com/cert-manager/cert-manager/releases/download/v1.7.1/cert-manager.yaml
<span class="nv">$ </span>kubectl <span class="nb">wait</span> <span class="nt">--for</span><span class="o">=</span><span class="nv">condition</span><span class="o">=</span>Ready pods <span class="nt">--all</span> <span class="nt">-n</span> cert-manager <span class="nt">--timeout</span><span class="o">=</span>60s
</code></pre></div></div>

<p>In addition, OpenShift router is needed for passing-through incoming TLS traffic into Flotta Edge API that handles incoming
requests from the edge devices.
For non-_OCP_ clusters types (<em>k8s</em>, <em>kind</em>, <em>minikube</em>), use the following command to install it:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl apply <span class="nt">-f</span> https://raw.githubusercontent.com/openshift/router/master/deploy/router_rbac.yaml
<span class="nv">$ </span>kubectl apply <span class="nt">-f</span> https://raw.githubusercontent.com/openshift/router/master/deploy/route_crd.yaml
<span class="nv">$ </span>kubectl apply <span class="nt">-f</span> https://raw.githubusercontent.com/openshift/router/master/deploy/router.yaml
<span class="nv">$ </span>kubectl <span class="nb">wait</span> <span class="nt">--for</span><span class="o">=</span><span class="nv">condition</span><span class="o">=</span>Ready pods <span class="nt">--all</span> <span class="nt">-n</span> openshift-ingress <span class="nt">--timeout</span><span class="o">=</span>60s
</code></pre></div></div>

<p><a href="https://noobaa.github.io/">Noobaa</a> is data service that provides S3 object-store interface. Flotta’s Edge API enables
edge devices to send application data to S3 endpoint, into a bucket claim created automatically for each device at
registration time. By default, <a href="https://github.com/kube-object-storage/lib-bucket-provisioner/blob/master/doc/design/object-bucket-lib.md#design"><em>Object Bucket Claim</em></a> (OBC) auto-creation is disabled. To enable it, follow the instructions <a href="#enable-object-bucket-claim-auto-creation">below</a>.
To use <em>Noobaa</em> to create a bucket claim for each device on registration you must enable OBC auto-creation.</p>

<p>For Installing <a href="https://noobaa.github.io/">Noobaa</a> on the cluster, follow <em>Noobaa</em>’s <a href="https://github.com/noobaa/noobaa-operator#usage">installation guide</a>.
Note that <em>Noobaa</em> requires additional resources, therefore additional memory and CPU are needed (+2 cpu, +5Gi memory).
<em>Noobaa</em> also requires a local storage class and a default storage class to be present on the cluster.</p>

<h3 id="install-flotta-operator">Install Flotta Operator</h3>
<p>To deploy the latest version of the <em>Flotta</em> operator execute following command:</p>

<p>For OpenShift Container Platform (<em>OCP</em>):</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl apply <span class="nt">-f</span> https://github.com/project-flotta/flotta-operator/releases/download/v0.1.0/ocp-flotta-operator.yaml
</code></pre></div></div>
<p>For kubernetes:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl apply <span class="nt">-f</span> https://github.com/project-flotta/flotta-operator/releases/download/v0.1.0/k8s-flotta-operator.yaml
</code></pre></div></div>

<p>By default, the <em>Flotta</em> operator is deployed in <code class="language-plaintext highlighter-rouge">flotta</code> namespace.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl get all <span class="nt">-n</span> flotta
NAME                                             READY   STATUS    RESTARTS        AGE
pod/flotta-controller-manager-7fd45874c6-wxxfv   2/2     Running   0               3d17h
pod/flotta-edge-api-8649fbb9dc-bt4r9             2/2     Running   0               3d17h

NAME                                                TYPE        CLUSTER-IP       EXTERNAL-IP   PORT<span class="o">(</span>S<span class="o">)</span>                      AGE
service/flotta-controller-manager-metrics-service   ClusterIP   10.128.238.94    &lt;none&gt;        8443/TCP,8080/TCP            3d17h
service/flotta-edge-api                             ClusterIP   10.129.85.18     &lt;none&gt;        8043/TCP,8080/TCP,8443/TCP   3d17h
service/flotta-webhook-service                      ClusterIP   10.128.120.232   &lt;none&gt;        443/TCP                      3d17h

NAME                                        READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/flotta-controller-manager   1/1     1            1           3d17h
deployment.apps/flotta-edge-api             1/1     1            1           3d17h

NAME                                                   DESIRED   CURRENT   READY   AGE
replicaset.apps/flotta-controller-manager-7fd45874c6   1         1         1       3d17h
replicaset.apps/flotta-edge-api-8649fbb9dc             1         1         1       3d17h

NAME                                       HOST/PORT           PATH   SERVICES          PORT    TERMINATION   WILDCARD
route.route.openshift.io/flotta-edge-api   project-flotta.io          flotta-edge-api   yggds   passthrough   None

</code></pre></div></div>

<p><em>Flotta</em> operator deploys two <a href="https://kubernetes.io/docs/concepts/extend-kubernetes/api-extension/custom-resources/#customresourcedefinitions">CustomResourceDefinitions (CRDs)</a>:</p>
<ol>
  <li><a href="https://github.com/project-flotta/flotta-operator/blob/main/config/crd/bases/management.project-flotta.io_edgeworkloads.yaml">EdgeWorkloads</a>, used to manage the workloads.</li>
  <li><a href="https://github.com/project-flotta/flotta-operator/blob/main/config/crd/bases/management.project-flotta.io_edgedevices.yaml">EdgeDevices</a> used to manage the devices.</li>
  <li><a href="https://github.com/project-flotta/flotta-operator/blob/main/config/crd/bases/management.project-flotta.io_edgedevicesets.yaml">EdgeDeviceSet</a> used to manage set of devices.</li>
  <li><a href="https://github.com/project-flotta/flotta-operator/blob/main/config/crd/bases/management.project-flotta.io_edgedevicesignedrequest.yaml">EdgeDeviceSignedRequest</a> used to manage approval of devices.</li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl get crd | <span class="nb">grep </span>project-flotta.io
edgedevices.management.project-flotta.io               2022-05-15T13:25:11Z
edgedevicesets.management.project-flotta.io            2022-05-15T13:25:11Z
edgedevicesignedrequest.management.project-flotta.io   2022-05-15T13:25:11Z
edgeworkloads.management.project-flotta.io             2022-05-15T13:25:11Z
</code></pre></div></div>

<p>By default, both operator manifests (for <em>OCP</em> and <em>k8s</em>) assume <a href="https://github.com/kube-object-storage/lib-bucket-provisioner/blob/master/pkg/apis/objectbucket.io/v1alpha1/objectbucketclaim_types.go">ObjectBucketClaim CRD</a> is installed on the cluster.
If it is not installed, there are two options, based on the needs:</p>

<h4 id="enable-object-bucket-claim-auto-creation">Enable Object Bucket Claim Auto Creation</h4>
<p>To enable <em>ObjectBucketClaim</em> auto-creation, Flotta’s operator config map needs to be patched and Flotta’s operator needs to be restarted:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl patch cm <span class="nt">-n</span> flotta flotta-manager-config <span class="nt">--type</span> merge <span class="nt">--patch</span> <span class="s1">'{ "data": { "OBC_AUTO_CREATE": "true"} }'</span>
kubectl rollout restart deploy/flotta-controller-manager <span class="nt">-n</span> flotta
</code></pre></div></div>

<p>That’s it for the operator side, next time we will take a look how to provision a machine with edge device, where we will deploy a simple nginx workload.</p>

        </div>
      </div>
    </div>
  </div>
</section>



<!-- blog -->
<section class="section">
  <div class="container">
    <div class="row">
      <div class="col-12 text-center">
        <h2 class="section-title">Similar Stories</h2>
      </div>
      
      <div class="col-lg-4 col-sm-6 mb-4">
  <article class="card shadow">
    
    <div class="card-body">
      <h4 class="card-title">
        <a class="text-dark" href="/flotta/2022/09/28/run-ansible-playbooks.html">Running Ansible Playbooks on Edge Devices</a>
      </h4>
      <p class="card-text">There may be cases in which you would like to be able to execute a scripts or commands in a device or on a group of devices. For example, in...</p>
      <a href="/flotta/2022/09/28/run-ansible-playbooks.html" class="btn btn-xs btn-primary">Read More</a>
    </div>
  </article>
</div>

      
      <div class="col-lg-4 col-sm-6 mb-4">
  <article class="card shadow">
    
    <div class="card-body">
      <h4 class="card-title">
        <a class="text-dark" href="/flotta/2022/09/05/edge-example-app-sense-the-internet-part-2.html">Edge Example App: Sense the Internet Part 2</a>
      </h4>
      <p class="card-text">Edge Example App is an app for Flotta Edge devices, with a workload that will be deployed on the device that has two main features: Sensing the Internet (which helps...</p>
      <a href="/flotta/2022/09/05/edge-example-app-sense-the-internet-part-2.html" class="btn btn-xs btn-primary">Read More</a>
    </div>
  </article>
</div>

      
      <div class="col-lg-4 col-sm-6 mb-4">
  <article class="card shadow">
    
    <div class="card-body">
      <h4 class="card-title">
        <a class="text-dark" href="/flotta/2022/09/05/edge-example-app-cpu-temp.html">Edge Example App: CPU Temperature</a>
      </h4>
      <p class="card-text">Edge Example App is an app for Flotta Edge devices, with a workload that will be deployed on the device that has two main features:
</p>
      <a href="/flotta/2022/09/05/edge-example-app-cpu-temp.html" class="btn btn-xs btn-primary">Read More</a>
    </div>
  </article>
</div>

      
    </div>
  </div>
</section>
<!-- /blog -->


  <!-- footer -->
<footer class="bg-dark footer-section">
  <div class="section">
    <div class="container">
      <div class="row">
        <div class="col-md-4">
          <h5 class="text-light">Email</h5>
          <p class="text-white paragraph-lg font-secondary">flotta@redhat.com</p>
        </div>
        <div class="col-md-4">
          <h5><a href="http://www.redhat.com"><img id="sponsorship" class="footerLogo" src="/assets/images/Logo-Red_Hat-Supported_By-A-Reverse-RGB.svg"></a>.</h5>
        </div>
        <!-- <div class="col-md-4"> -->
        <!--   <h5 class="text-light">Address</h5> -->
        <!--   <p class="text-white paragraph-lg font-secondary"></p> -->
        <!-- </div> -->
      </div>
    </div>
  </div>
  <div class="border-top text-center border-dark py-5">
    <p class="mb-0 text-light"><p>Copyright © 2020 Designed by <a href="https://themefisher.com">Themefisher</a> &amp; Developed by <a href="https://getjekyllthemes.com">Getjekyllthemes</a></p>
</p>
  </div>
</footer>
<!-- /footer -->


<!-- JS Plugins -->

<script src="/assets/plugins/jQuery/jquery.min.js"></script>

<script src="/assets/plugins/bootstrap/bootstrap.min.js"></script>

<script src="/assets/plugins/shuffle/shuffle.min.js"></script>

<script src="/assets/plugins/slick/slick.min.js"></script>


<!-- Main Script -->
<script src="/assets/js/script.js"></script>

<!-- This comes from DTM/DPAL and must be latest entry in body-->
<script type="text/javascript">
  if (("undefined" !== typeof _satellite) && ("function" === typeof _satellite.pageBottom)) {
      _satellite.pageBottom();
  }
</script>


<script>
  $(function() {
    return $("h2, h3, h4, h5, h6").each(function(i, el) {
      var $el, icon, id;
      $el = $(el);
      id = $el.attr('id');
      icon = '<i class="ti-link"></i>';
      console.log("test test"+id)
      if (id) {
        return $el.prepend($("<a />").addClass("header-link").attr("href", "#" + id).html(icon));
      }
    });
  });
</script>


</body>

</html>
